#!/usr/bin/env bash
set -uo pipefail

source utils.sh

if [[ "${CONJUR_OSS_HELM_INSTALLED}" == "true" ]]; then
  ./cleanup_helm.sh
  ./cleanup_namespaces.sh

elif [[ "$CONJUR_PLATFORM" == "gke" ]]; then
  run_command_with_platform "
    ./cleanup_helm.sh
    pushd temp/kubernetes-conjur-deploy-$UNIQUE_TEST_ID && ./stop && popd
    ./cleanup_namespaces.sh
  "
  rm -rf temp/kubernetes-conjur-deploy-"$UNIQUE_TEST_ID"

elif [[ "$CONJUR_PLATFORM" == "jenkins" ]]; then
  pushd temp/conjur-intro-"$UNIQUE_TEST_ID" > /dev/null
    ./bin/dap --stop
  popd > /dev/null
  rm -rf temp/conjur-intro-"$UNIQUE_TEST_ID"

  run_command_with_platform "
    ./cleanup_helm.sh
    ./cleanup_namespaces.sh
  "

fi
